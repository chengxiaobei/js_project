<!DOCTYPE HTML>
<html>
<head>  
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no" />
<title>欢乐大转盘</title>
<link type="text/css" rel="stylesheet"
	href="../../public/css/activity.css">
<script type="text/javascript" src="../../public/less/less.js"></script>
<script src="../../public/js/common/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="jQueryRotate.2.2.js"></script>
<script type="text/javascript" src="jquery.easing.min.js"></script>
<script src="../../public/js/common/globalvar.js"></script>
</head>
<body class="zhuanpan-download-body zhuanpan-download-bodytwo">
	<div class="wrap">
		<section>
			<div class="mask" id="hasend" style="display: none">
				<div class="zhuanpan-alert">
					<!--中奖产品使用背景zhuanpan-alert-bg 已结束使用类zhuanpan-alert-overbg-->
					<div class="zhuanpan-alert-bg zhuanpan-alert-overbg">
						
					</div>
				</div>
			</div>
			<div class="mask" id="nostart" style="display: none">
				<div class="zhuanpan-alert">
					<!--中奖产品使用背景zhuanpan-alert-bg-->
					<div class="zhuanpan-alert-bg zhuanpan-alert-wksbg">
					
					</div>
				</div>
			</div>
			<div class="mask" id="nologin" style="display: none">
				<div class="zhuanpan-alert">
					<!--中奖产品使用背景zhuanpan-alert-bg 未登录使用类zhuanpan-alert-loginbg-->
					<div class="zhuanpan-alert-bg zhuanpan-alert-loginbg">
						<p class="zhuanpan-alert-dl">请先去个人中心登录吧</p>
					</div>
				</div>
			</div>
			<div class="mask" id="nochance" style="display: none">
				<div class="zhuanpan-alert">
					<!--中奖产品使用背景zhuanpan-alert-bg-->
					<div class="zhuanpan-alert-bg">
						<a class="zhuanpan-alert-btn finish">好吧</a>
					</div>
				</div>
			</div>
			 <div class="mask" id="nogoodchance" style="display: none">
		        <div class="zhuanpan-alert">
		          <!--中奖产品使用背景zhuanpan-alert-bg-->
		          <div class="zhuanpan-alert-bg zhuanpan-alert-swnonebg">
		            <a class="zhuanpan-alert-btn finish">好吧</a>
		          </div>
		        </div>
		      </div>
			<div class="mask" id="luck" style="display: none">
				<div class="zhuanpan-alert">
					<!--明天继续使用背景zhuanpan-alert-bg，中奖的几个背景使用类zhuanpan-alert-probg-->
					<div class="zhuanpan-alert-bg zhuanpan-alert-probg">
						<img class="luckimg" src="">
						<h3>
							获得了<span id='luckcontent'></span>1个！
						</h3>
						<p>（活动结束后我们会和您联系）</p>
						<a class="zhuanpan-alert-btn finish">笑纳了</a>
					</div>
				</div>
			</div>
			<div class="mask" id="yzb" style="display: none">
				<div class="zhuanpan-alert">
					<!--明天继续使用背景zhuanpan-alert-bg，中奖的几个背景使用类zhuanpan-alert-probg-->
					<div class="zhuanpan-alert-bg zhuanpan-alert-probg">
						<img class="yzbimg" src="">
						<!--这个页面需要加上这个样式style="left:95px;"-->
						<p class="alert-probg-linetwo" style="left: 95px;position:static;">
							获得了<span class="yzbnum"></span>枚养殖币
						</p>
						<a class="zhuanpan-alert-btn finish">笑纳了</a> <span
							class="zhuanpan-alert-binum">+<span class="yzbnum"></span></span>
					</div>
				</div>
			</div>
			<!-- 奖品被抽光了没有 -->
			<div class="mask" id="nogoods" style="display: none">
				<div class="zhuanpan-alert">
					<!--中奖产品使用背景zhuanpan-alert-bg-->
					<div class="zhuanpan-alert-bg zhuanpan-alert-ycwbg">
						<a class="zhuanpan-alert-btn finish">好吧</a>
					</div>
				</div>
			</div>
			
			<div class="mask" id="nothing" style="display: none">
				<div class="zhuanpan-alert">
					<!--明天继续使用背景zhuanpan-alert-bg，未中奖使用背景zhuanpan-alert-noprobg-->
					<div class="zhuanpan-alert-bg zhuanpan-alert-noprobg">
						<a class="zhuanpan-alert-btn finish">好吧</a>
					</div>
				</div>
			</div>

			<div class="zhuanpan-main">
				<div class="zhuanpan-main-con">
					<img id = "changeimg" src="../../public/images/大转盘.png"> <img id="startbtn"
						class="zhuanpan-check"
						src="../../public/images/zhuanpan-check.png">
					<!-- 机会个数-->
					<div class="zhuanpan-jihui">
						<p>今天还剩</p>
						<p class="zhuanpan-jihui-num">
							<span id="chance"></span>次抽奖机会
						</p>
					</div>
				</div>
			</div>
			<!-- 整体树杠背景-->
			<div class="zhuanpan-bom-bg">
				<!-- 我的奖品-->
				<div class="zhuanpan-mypre" id = "hasprize">
                  <div class="zhuanpan-mypre-main" id="container">
					<div class="right zhuanpan-mypre-right" id="longwidth">
						<!-- 带图片的-->
						<div class="left" id="div1">
				
						</div>
						<div class="left" id="div2">
						
						</div>
					</div>
				   <div class="clearf"></div>
                  </div>
                  <img class="zhuanpan-mypre-img" src="../../public/images/zhuanpan-mypre.png">
				</div>
				<div class="zhuanpan-mypre" id = "noprize" style="display:none">
                  <div class="zhuanpan-mypre-main" style="text-align:center">
					
						<!-- 带图片的-->
						<div  id="div3">
						
						</div>
					
				   
                  </div>
                  <img class="zhuanpan-mypre-img" src="../../public/images/zhuanpan-mypre.png">
				</div>
				<div class="zhuanpan-mypre" id = "oneprize" style="display:none">
                  <div class="zhuanpan-mypre-main">
					<div class="right zhuanpan-mypre-right">
						<!-- 带图片的-->
						<div class="left" id="div4">
						
						</div>
					</div>
				   <div class="clearf"></div>
                  </div>
                  <img class="zhuanpan-mypre-img" src="../../public/images/zhuanpan-mypre.png">
				</div>
				<!-- 排行榜-->
				<div class="zhuanpan-phb-bg">
					<img class="left zhuanpan-phb-bgimg"
						src="../../public/images/zhuanpan-dianbg.png">
					<p>活动养殖币排行榜</p>
					<div class="winningInfo_wrap"
						style="overflow: hidden; height: 120px;">
						<div class='winningInfo'></div>
						<div class='winningInfo2'></div>
					</div>

					<p class="zhuanpan-mingdan-martop">我的排名</p>
					<div class="zhuanpan-mingdan">
						<p class="left mypm"></p>
						<p class="left mingdan-tel myname"></p>
						<p class="right myscore"></p>
						<div class="clearf"></div>
					</div>
				</div>
				<!-- 活动说明-->
				<div class="zhuanpan-hd-con">
					<p class="zhuanpan-hd-title">活动说明</p>
					<div class="zhuanpan-hd-maincon">
						<p>1.活动时间：2016年7月27日-2016年7月31日；</p>
						<p>2.每位用户每日有3次抽奖机会；</p>
						<p>3.活动结束后按获得累计养殖币排名，第一名可兑换华为手机一部；第二名可兑换瑞士双肩背包一个；第三名可兑换小米自拍杆一个；</p>
						<p>4.奖品于活动结束后三个工作日内统一发出，届时养殖宝客服人员会与您联系；</p>
						<p>5.活动最终解释权归养殖宝所有。</p>
					</div>
				</div>
			</div>
		</section>
	</div>
</body>
<script>
var urlzhuanpan = global_path + 'index.php/activitycenter/zhuanpan';
var urllist = global_path + 'index.php/activitycenter/lotterylist';
var user_code = getQueryString('code')
		|| (RP.store.getItem('curr_user_info') ? RP.store
				.getItem('curr_user_info').user_code : "");
var date = new Date();
var enddate = "2016/5/28 23:59:59";//活动结束时间
var startdate = "2016/5/12 00:00:00";//活动开始时间
var goodsstartdate = "2016/5/18 00:00:00";
var goodsenddate = "2016/5/19 23:59:59"
var activity_code = '';
var codelist = [ 'A1605061628880','A1605131183311'];
var paramslist = {
	user_code : user_code,
	activity_code : activity_code,
	list : codelist
};
var params = {
	user_code : user_code,
	activity_code : activity_code
};
var speed = 60;
var winningInfo_wrap = document.querySelector('.winningInfo_wrap');
var winningInfo = document.querySelector('.winningInfo');
var winningInfo2 = document.querySelector('.winningInfo2');
(function() {
	if (date.getTime()>new Date(goodsstartdate).getTime()&&date.getTime()<new Date(goodsenddate).getTime()) {
		$('#changeimg').attr('src','../../public/images/大转盘02.png');
		paramslist.activity_code = "A1605131183311";
		params.activity_code = "A1605131183311";
		$('.zhuanpan-jihui').hide();
	} else {
		$('#changeimg').attr('src','../../public/images/大转盘01.png');
		paramslist.activity_code = "A1605061628880";
		params.activity_code = "A1605061628880";
	}
	console.log(user_code);
	if (new Date(enddate).getTime() <= date.getTime()) {
		$('#hasend').show();
	} else if (new Date(startdate).getTime() >= date.getTime()) {
		$('#nostart').show();
	} else {
		if (user_code == null || user_code == "") {
			$('#nologin').show();
			
		} else {
			update();
		}
	}
	
})();

var MyMar2 = setInterval(Marquee2, 60);
function Marquee2() {
	if ($("#container").scrollLeft() > $("#div1").width()) { //当滚动条隐藏的长度大于div1的宽度
		
		$("#container").scrollLeft(0);
	} else {
		$("#container").scrollLeft($("#container").scrollLeft() + 1); //每次滚动条往右移动1px；
	}
}
var MyMar = setInterval(Marquee, speed);
function Marquee() {
	if (winningInfo_wrap.scrollTop >= winningInfo2.offsetHeight)
		winningInfo_wrap.scrollTop = 0;
	else {
		winningInfo_wrap.scrollTop++;
	}
}
function update() {

	commonAjax(
			urllist,
			paramslist,
			function(data) {
				if (data.status == "2000") {
					var html = "";
					var htmlgood="";
					$('#chance').html(data.data.lottery_limint);
					if (data.data.user_score_list.length == 0) {
						$('.winningInfo')
								.html(
										'<div class="zhuanpan-mingdan" style="color:#ca6c10">暂无信息</div>');
					} else {
						for (var i = 0; i < data.data.user_score_list.length; i++) {
							html += '<div class="zhuanpan-mingdan">'
									+ '<p class="left">' + (i + 1) + '</p>'
									+ '<p class="left mingdan-tel">'
									+ data.data.user_score_list[i].nickname
									+ '</p>' + '<p class="right">'
									+ data.data.user_score_list[i].scores
									+ '</p>' + '<div class="clearf"></div>'
									+ '</div>'
						}
						$('.winningInfo').html(html);
						if (data.data.user_score_list.length > 4) {
							$('.winningInfo2').html(html);
						}

					}
					if(data.data.user_score.length == 0){
						$('#hasprize').hide();
						$('#noprize').show();
						$('#oneprize').hide();
						$('#div3').html(
					                   '<p style="margin-top:30px;font-size:16px;color:#fff;">暂无奖品！</p>'
					             
					        )
					    //clearInterval(MyMar2);
					}else if(data.data.user_score.length == 1){
						$('#hasprize').hide();
						$('#noprize').hide();
						$('#oneprize').show();
						if(data.data.user_score[0].type == "4"){
							$("#div4").html('<div class="left mypre-right-one" style="margin-left:10%;width:180px">'+
							'<img class="left" src="'+data.data.user_score[0].icon+'">'+
							'<p class="left" style="margin: 15px 0 0 16px;">'+
								'养殖币+<span>'+data.data.user_score[0].scores+'</span>'+
							'</p>'+
							'<div class="clearf"></div>'+
						  '</div>')   
						}else{
							$("#div4").html('<div class="left mypre-right-one" style="margin-left:10%;width:180px">'+
								 '<img class="left" src="'+data.data.user_score[0].icon+'">'+
								 '<p class="left" style="margin: 15px 0 0 16px;">'+data.data.user_score[0].name+'</p>'+
								 '<div class="clearf"></div>'+
							   '</div>')  
						}
						
					   //clearInterval(MyMar2);
						
					}else{
						$('#hasprize').show();
						$('#noprize').hide();
						$('#oneprize').hide();
						for (var j = 0; j < data.data.user_score.length; j++) {
							if(data.data.user_score[j].type == "4"){
								htmlgood += '<div class="left mypre-right-one">'+
								'<img class="left" src="'+data.data.user_score[j].icon+'">'+
								'<p class="left" style="margin: 15px 0 0 16px;">'+
									'养殖币+<span>'+data.data.user_score[j].scores+'</span>'+
								'</p>'+
								'<div class="clearf"></div>'+
							  '</div>'   
							}else{
								htmlgood += '<div class="left mypre-right-one">'+
									 '<img class="left" src="'+data.data.user_score[j].icon+'">'+
									 '<p class="left" style="margin: 15px 0 0 16px;">'+data.data.user_score[j].name+'</p>'+
									 '<div class="clearf"></div>'+
								   '</div>'  
							}
							
						}
					    htmlgood+='<div class="clearf"></div>';
						$("#div1").html(htmlgood);
						$("#div2").html(htmlgood);
					}

					$('.mypm').html(data.data.user_score_rangking.rangking);
					$('.myname').html(
							data.data.user_score_rangking.nickname);
					$('.myscore')
							.html(data.data.user_score_rangking.scores);

				} else if (data.status == "80003") {
					$('#nostart').show();
					
				} else if (data.status == "80005") {
					$('#hasend').show();
					
				}

			})

}
(function() {
	$('#startbtn').on('click', function() {
		if ($('#startbtn').hasClass('off')) {

		} else {
			$('#startbtn').addClass('off');
			lottery();
		}

	})
	$('.finish').on('click', function() {
		$('#startbtn').removeClass('off');
		update();
		$('#yzb').hide();
		$('#nochance').hide();
		$('#nogoodchance').hide();
		$('#luck').hide();
		$('#nothing').hide();
		$('#nogoods').hide();
	})
})();
function lottery() {
	commonAjax(urlzhuanpan, params, function(data) {
		if (data.status == "80000") {
			var a = data.data.angle; //角度 
			var p = data.data.prize_name; //奖项 
			$("#startbtn").rotate({
				duration : 3000, //转动时间 
				angle : 0,
				animateTo : 1800 + a, //转动角度 
				easing : $.easing.easeOutSine,
				callback : function() {
					if (data.data.type == "4") {
						$('.yzbnum').html(data.data.score);
						$('.yzbimg').attr('src', data.data.icon);
						$('#yzb').show();
					} else if (data.data.type == "1") {
						$('#luckcontent').html(data.data.prize_name);
						$('.luckimg').attr('src', data.data.icon);
						$('#luck').show();
					} else if (data.data.type == "0") {
						$('#nothing').show();
					}

				}
			});
			
		}else if(data.status == "80001"||data.status == "80008") {
			//未中奖//中奖次数达到上限
			var a = 340; //角度 
			var p = '谢谢参与'; //奖项 
			$("#startbtn").rotate({
				duration : 3000, //转动时间 
				angle : 0,
				animateTo : 1800 + a, //转动角度 
				easing : $.easing.easeOutSine,
				callback : function() {				
						$('#nothing').show();

				}
			});
		}
		else if (data.status == "80009") {
			//抽奖次数达到上限
			if (date.getTime()>new Date(goodsstartdate).getTime()&&date.getTime()<new Date(goodsenddate).getTime()) {
				$('#nogoodchance').show();
			} else {
				$('#nochance').show();
			}
			
		
		} else if (data.status == "80003") {
			$('#nostart').show();
			
		} else if (data.status == "80005") {
			$('#hasend').show();
			
		}

	});
}
</script>
</html>
