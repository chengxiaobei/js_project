<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<script type="text/javascript" src="../../public/js/common/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="../../public/js/common/globalvar.js"></script>
</head>
<body>
	<canvas id="canvas">
		浏览器不支持	
	</canvas>
</body>

<script type="text/javascript">
	
	// $.ajax({
	// 	url : global_path +  'index.php/test/test1',
	// 	dataType:'json' ,
	// 	success:function(data){
	// 		console.info(data) 
	// 		canvas_handle(data) ;		}
	// }) ;

	var canvas = document.getElementById('canvas') ;
	var ctx = canvas.getContext('2d') ;

	var img = new Image() ;

	function canvas_handle(data) {
		// img.src = 'http://123.56.146.81:8685/assets/images/ask/201512/CA4DD5DD22EC25E43D6BACE9E647B439_HD.jpg' ;
		// console.info(dataURLtoBlob(data.url)) ;

		// img.src = data.url ;
		img.src = 'psb.jpg' ;
		img.onload = function(){
			img.crossOrigin = "*" ;
			// canvas.width = img.width  ;
			// canvas.height = img.height ;

			var scale = 640 / img.width ;

			canvas.width = 640 ;
			canvas.height = parseInt(img.height * scale ) ;

			// console.info('img.width = ' + img.width) ;
			// console.info('img.height = ' + img.height) ;

			ctx.drawImage(img,0,0,img.width,img.height,0,0,canvas.width,canvas.height) ;

			var base64 = canvas.toDataURL("image/jpeg",scale) ;
			// var base64 = canvas.toDataURL() ;
			// window.location.href = base64 ;
			console.info(dataURLtoBlob(base64)) ;
		}
	}

	canvas_handle() ;

	

	



</script>
</html>